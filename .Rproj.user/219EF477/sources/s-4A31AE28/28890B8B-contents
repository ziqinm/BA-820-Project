options(stringsAsFactors = FALSE)

#EFA
library(factoextra)
library(corrplot)
library(psych)
library(GPArotation)

scaleCol = read_csv("scaleCol.csv")

scaleCol_cor <- cor(scaleCol)
cortest.bartlett(scaleCol_cor, nrow(scaleCol))
KMO(scaleCol_cor)
corrplot(scaleCol_cor,
         type="upper",
         diag=F,
         method='color',
         order="hclust")

scaleCol_s = scale(scaleCol)
scaleCol_pca = prcomp(scaleCol_s, center=TRUE, scale=TRUE)
summary(scaleCol_pca)
fviz_screeplot(scaleCol_pca, addlabels=T, ncp = 20)
# Elbow: 6, 11, 17
num_f = fa.parallel(scaleCol_s, fm="ml", fa="fa")
# 6 factors
sum(num_f$fa.values >1)
# 2 factors
sum(num_f$fa.values >0.7)
# 3 factors

# Try 3 factors
fa3 = fa(scaleCol_s, nfactors=3, rotate="oblimin", fm="ml")
print(fa3, cut=.3)
